{% extends async ? 'async-layout.html' : 'layout.html' %}

{% block title %}Livre d'or{% endblock %}

{% block header_photo %}livre.jpg{% endblock %}

{% block content %}

{{ parent() }}

<div class="row-fluid">
  <h1>Livre d'or</h1>
</div>
<div class="row-fluid">
 	<p class="span6 offset3">
	 	<strong>Faites-nous part de votre expérience</strong><br/>
	 	Si vous avez apprécié le Salon, ou que vous trouvez que certaines choses auraient pu être améliorées, faites-le nous savoir, et nous en tiendrons compte.
	<p>
</div>

{% if not isLogged() %}

<div class="row-fluid">
  <div class="span10 offset1">
	
		<!-- Si jamais il y a une erreur lors de l'appel du commentaire -->
		{% if errors is not empty %}
		<div class="alert alert-error">
			<button type="button" class="close" data-dismiss="alert">&times;</button>
			<strong>Erreur : </strong>
			<ul>
			  {% for error in errors %}
			  <li>{{ error }}</li>
			  {% endfor %}
			</ul>
		 </div>
		{% elseif success %}
		<div class="alert alert-success">
		   <button type="button" class="close" data-dismiss="alert">&times;</button>
		   <strong>Merci !</strong> Votre commentaire a bien été enregistré, il sera publié après validation.
		</div>
		{% endif %}
    
		<!-- Formulaire pour les commentaires pour le livre d'or -->
		<form class="commentForm" method="post" action="{{ queries('index','livredor',{}) }}">
			<!-- ici on écrit le commentaire dans le textarea, un code javascript permet de limiter le nombre de caractères à 250 -->
			<textarea class="commentText span12" maxChar="250" rows="3" cols="200" name="commentaire" placeholder="Saisissez votre commentaire">{{ commentaire }}</textarea> 			
			<br />
			<div class="pull-left">
			 <label for="email">Votre email :</label>
			   <input class="span11" type="text" id="email" name="email" placeholder="(facultatif)"/>
			</div>
			 <label for="antispam">Anti-spam :</label>
			   <input type="text" id="antispam" name="antispam" placeholder="Combien font {{ antiSpam }} ?"/>
			<div class="pull-right">
			 <span class="commentCharCount">250</span>
			 <input type="submit" class="btn" value="Envoyer votre commentaire" />
			</div>
		</form>
	</div>
</div>
<hr/>

{% endif %}

<div class="row-fluid">
  <div class="span10 offset1">
		{% if commentaires is not empty %}
		<table class="table table-hover" style="table-layout:fixed;">
		  <thead>
		    <th>Commentaires</th>
			</thead>
		  {% for commentaire in commentaires %}
		  <tr>
			  <td class="row-fluid">
		     {% if isLogged() %}
		     <div class="pull-right">
		      <form class="formGestionComm" method="post" action="{{ queries('administrateur','commentaire_gerer',{}) }}" >
             <input type="hidden" name="filled" value="true" />
             <input type="hidden" name="action" value ="delete" />
             <input type="hidden" name="idCom" value="{{ commentaire.idComm }}" />
		         de <strong>{{ commentaire.mail }}</strong>
             <input type="submit" class="btn btn-danger" value="x">
          </form>
		     </div>
			   <div class="span9" style="word-wrap:break-word;">
			     &laquo; {{ commentaire.commentaire }} &raquo;
			   </div>
		     {% endif %}
			  </td>
		  </tr>
		  {% endfor %}
		</table>
		{% else %}
		<p><em>Il n'y a aucun commentaire à afficher</em></p>
		{% endif %}
  </div>
</div>

<script>
$(document).ready(function() {
	  $(".commentText").bind('input propertychange', function() {
	    var max = $(this).attr("maxChar");
	    var count = $(this).val().toString().length;
	    var charLeft = max - count;
	    $(".commentCharCount").html(charLeft);
	    if(charLeft < 0) {
	      $(".commentCharCount").css("color","red");
	    }
	    else {
	      $(".commentCharCount").css("color","black");
	    }
	  });
	});
</script>

{% endblock %}